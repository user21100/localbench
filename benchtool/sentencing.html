<!--
Restored full UI/UX from original sentencing.html (offline, local-only)
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NY Sentencing Guide - Local Judicial Bench</title>
    <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400..700;1,400..700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Lora', serif; background: #f8fafc; color: #222; }
        .header, h1, h2 { text-align: center; }
        .header { background: #1e293b; color: #fff; padding: 2rem 1rem 1rem 1rem; border-radius: 0 0 1.5rem 1.5rem; box-shadow: 0 2px 8px #0001; }
        .container { max-width: 900px; margin: 2rem auto; background: #fff; border-radius: 1.5rem; box-shadow: 0 2px 8px #0001; padding: 2rem; }
        .offline { font-size: 0.95rem; color: #64748b; margin-bottom: 1rem; }
        .search-section { margin-bottom: 2rem; }
        .search-container { position: relative; max-width: 600px; margin: 0 auto; }
        .search-bar { width: 100%; padding: 1rem; border-radius: 0.75rem; border: 1px solid #cbd5e1; font-size: 1.1rem; margin-bottom: 0.5rem; }
        .search-results { position: absolute; top: 100%; left: 0; right: 0; background: white; border: 1px solid #d1d5db; border-top: none; border-radius: 0 0 8px 8px; max-height: 300px; overflow-y: auto; z-index: 1000; display: none; box-shadow: 0 8px 16px rgba(0,0,0,0.1); }
        .search-result-item { padding: 12px 20px; cursor: pointer; border-bottom: 1px solid #f1f5f9; transition: background-color 0.2s ease; }
        .search-result-item:hover, .search-result-item.focused { background: #f8fafc; }
        .search-result-item:last-child { border-bottom: none; }
        .offense-name { font-weight: 600; color: #1e293b; margin-bottom: 4px; }
        .offense-details { font-size: 14px; color: #475569; }
        .selected-offense { background: #f1f5f9; border: 1px solid #e2e8f0; border-radius: 8px; padding: 20px; display: none; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; }
        .offense-info-container { flex-grow: 1; }
        .offense-sub-line { display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }
        .attempt-badge { background-color: #facc15; color: #422006; font-size: 0.8rem; font-weight: 700; padding: 5px 10px; border-radius: 6px; text-transform: uppercase; border: 1px solid #eab308; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .violent-badge { background-color: #fecaca; color: #991b1b; font-size: 0.8rem; font-weight: 700; padding: 5px 10px; border-radius: 6px; text-transform: uppercase; border: 1px solid #fca5a5; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .modifiers-section { padding: 30px; background: #f8fafc; border-top: 1px solid #e2e8f0; display: none; }
        .modifiers-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .modifier-group { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); border: 1px solid #e2e8f0; }
        .modifier-group .label-container { display: flex; justify-content: space-between; align-items: center; }
        .modifier-group label.modifier-label { font-weight: 600; color: #1e293b; flex-grow: 1; margin-right: 15px; }
        .modifier-definition { font-size: 0.9rem; color: #475569; margin-top: 8px; padding-top: 8px; border-top: 1px solid #f1f5f9; }
        .toggle-switch { position: relative; display: inline-block; width: 40px; height: 24px; flex-shrink: 0; }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #cbd5e1; transition: .4s; border-radius: 24px; }
        .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: #334155; }
        input:checked + .slider:before { transform: translateX(16px); }
        input:disabled + .slider { background-color: #e2e8f0; cursor: not-allowed; opacity: 0.7; }
        .results-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 32px;
            padding: 0;
            margin: 0;
        }
        .result-card {
            background: #f8fafc;
            border-radius: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
            border: 1.5px solid #e2e8f0;
            padding: 24px 18px 18px 18px;
            margin-bottom: 0;
        }
        .sentence-option {
            background: #fff;
            border-radius: 14px;
            border: 1.5px solid #e2e8f0;
            margin-bottom: 18px;
            padding: 18px 16px;
            transition: box-shadow 0.2s, border-color 0.2s;
            box-shadow: 0 1px 4px rgba(0,0,0,0.04);
        }
        .sentence-option.eligible { border-left: 5px solid #22c55e; }
        .sentence-option.caution-option { border-left: 5px solid #facc15; }
        .sentence-option.alternative-option { border-left: 5px solid #2563eb; }
        .sentence-option.unavailable-option {
            opacity: 0.6;
            background: #f3f4f6;
            border-left: 5px solid #d1d5db;
            pointer-events: none;
        }
        .sentence-type { font-weight: 600; font-size: 1.1rem; margin-bottom: 6px; }
        .sentence-details-grid { display: grid; grid-template-columns: auto 1fr; gap: 5px 15px; align-items: center; margin-top: 8px; }
        .sentence-label { font-weight: 500; text-align: right; font-size: 0.95rem; color: #475569; }
        .sentence-value { font-weight: 600; color: #0f172a; font-size: 0.95rem; }
        .prominent-term { font-weight: 700; font-size: 1.15rem; color: #b91c1c; }
        .sentence-description { grid-column: 1 / -1; font-size: 0.85rem; color: #475569; margin-top: 8px; padding-top: 8px; border-top: 1px dashed #e2e8f0; }
        .unavailable-reason { font-style: italic; color: #9ca3af; margin-top: 8px; padding-top: 8px; border-top: 1px dashed #e5e7eb; font-size: 0.9rem; grid-column: 1 / -1; }
        @media (max-width: 600px) { .container { padding: 0.5rem; } .modifiers-grid { grid-template-columns: 1fr; } }
        @media (max-width: 900px) { .results-section { grid-template-columns: 1fr; } }
        @media print { .header, .search-section, .modifiers-section, .no-print { display: none !important; } .container { box-shadow: none !important; } .results-section { display: block !important; } }
    </style>
</head>
<body>
    <div class="header" style="text-align:center;">
        <h1>NY Sentencing Guide</h1>
        <div class="offline">Local, Offline Judicial Toolkit <span style="background:#c7d2fe;color:#3730a3;padding:2px 8px;border-radius:8px;font-size:0.95em;">Offline</span></div>
        <div style="font-size:0.95em;"><span style="font-size:1.1em;">&#128190;</span> All data stored locally</div>
    </div>
    <div class="container">
        <div class="search-section">
            <div class="search-container">
                <input id="offenseSearchInput" class="search-bar" type="text" placeholder="Search for an offense by name or section..." autocomplete="off" />
                <div id="offenseSearchResults" class="search-results"></div>
            </div>
            <div class="selected-offense" id="selectedOffense">
                <div class="offense-info-container">
                    <div id="offenseName" style="font-size: 1.25rem; font-weight: 600; color: #1e293b; margin-bottom: 5px;"></div>
                    <div class="offense-sub-line">
                        <div id="offenseDetails" style="color: #64748b; font-size: 1rem;"></div>
                        <span id="attempt-badge" class="attempt-badge" style="display: none;">Attempt</span>
                        <span id="violent-badge" class="violent-badge" style="display: none;">VIOLENT</span>
                    </div>
                </div>
                <button onclick="copySummaryToClipboard()" id="copySummaryBtn" class="btn btn-copy-summary no-print">ðŸ“‹ Copy Summary</button>
            </div>
        </div>
        <div class="modifiers-section no-print" id="modifiersSection">
            <h3 style="color: #1e293b; margin-bottom: 15px;">Sentencing Modifiers</h3>
            <div class="modifiers-grid">
                <div class="modifier-group">
                    <div class="label-container">
                        <label class="modifier-label">Attempt (PL Â§ 110.00)</label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="attemptToggle">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="modifier-definition">Reduces the offense class by one level.</div>
                </div>
                <div class="modifier-group">
                    <div class="label-container">
                        <label class="modifier-label">Second Felony Offender (Predicate)</label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="predicateToggle">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="modifier-definition">Convicted of a felony within the last 10 years.</div>
                </div>
                <div class="modifier-group">
                    <div class="label-container">
                        <label class="modifier-label">Violent Predicate</label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="violentPredicateToggle">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="modifier-definition">Prior violent felony conviction.</div>
                </div>
                <div class="modifier-group">
                    <div class="label-container">
                        <label class="modifier-label">Persistent Felony Offender</label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="persistentToggle">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="modifier-definition">Two or more prior felony convictions.</div>
                </div>
                <div class="modifier-group">
                    <div class="label-container">
                        <label class="modifier-label">Youthful Offender</label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="yoToggle">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="modifier-definition">Eligible for YO adjudication.</div>
                </div>
            </div>
        </div>
        <div class="results-section" id="resultsSection">
            <div class="result-card">
                <h3>Primary Sentencing Options</h3>
                <div id="primaryOptions"></div>
            </div>
            <div class="result-card">
                <h3>Alternative Dispositions</h3>
                <div id="alternativeOptions"></div>
            </div>
        </div>
        <div id="noSelection" class="no-selection">Search and select an offense above to view sentencing options.</div>
    </div>
    <!-- Move scripts to end of body for guaranteed load order -->
    <script src="master_offense_database.js"></script>
    <script src="local_bench_api.js"></script>
    <script>
    // --- UI State ---
    let selectedOffense = null;
    let modifiers = { attempt: false, predicate: false, violentPredicate: false, persistent: false, yo: false };

    // --- Attach local offense search UI ---
    window.OffenseSearchAPI.attachSearchUI('offenseSearchInput', 'offenseSearchResults', function(offense) {
        selectedOffense = offense;
        document.getElementById('selectedOffense').style.display = 'flex';
        document.getElementById('modifiersSection').style.display = 'block';
        document.getElementById('resultsSection').style.display = 'grid';
        document.getElementById('noSelection').style.display = 'none';
        renderSelectedOffense();
        renderResults();
    });

    // --- Modifier toggles logic ---
    ['attemptToggle', 'predicateToggle', 'violentPredicateToggle', 'persistentToggle', 'yoToggle'].forEach(id => {
        document.getElementById(id).addEventListener('change', function() {
            // Only one of predicate/violent/persistent can be active
            if (["predicateToggle","violentPredicateToggle","persistentToggle"].includes(id) && this.checked) {
                ["predicateToggle","violentPredicateToggle","persistentToggle"].forEach(otherId => {
                    if (otherId !== id) document.getElementById(otherId).checked = false;
                });
            }
            modifiers[id.replace('Toggle','')] = this.checked;
            renderBadges();
            renderResults();
        });
    });

    // --- Render selected offense card ---
    function renderSelectedOffense() {
        if (!selectedOffense) return;
        document.getElementById('offenseName').textContent = selectedOffense.name;
        document.getElementById('offenseDetails').textContent = `${selectedOffense.section} - Class ${selectedOffense.class}`;
        renderBadges();
    }
    function renderBadges() {
        document.getElementById('attempt-badge').style.display = modifiers.attempt ? 'inline-block' : 'none';
        document.getElementById('violent-badge').style.display = selectedOffense && selectedOffense.vfo ? 'inline-block' : 'none';
    }

    // --- Render sentencing results ---
    function renderResults() {
        if (!selectedOffense) return;
        const { primaryOptions, alternativeOptions } = window.SentencingAPI.getFullSentencingOptions(selectedOffense, modifiers);
        // Sort: eligible (green) first, caution (yellow) next, unavailable (gray) last
        const sortOrder = { 'eligible': 1, 'alternative-option': 1, 'yo-active': 1, 'caution-option': 2, 'yellow': 2, 'unavailable-option': 3 };
        function sortOptions(a, b) {
            return (sortOrder[a.status] || 99) - (sortOrder[b.status] || 99);
        }
        document.getElementById('primaryOptions').innerHTML = primaryOptions.sort(sortOptions).map(opt => opt.html).join('');
        document.getElementById('alternativeOptions').innerHTML = alternativeOptions.sort(sortOptions).map(opt => opt.html).join('');
    }
    function copySummaryToClipboard() {
        if (!selectedOffense) return;
        const details = window.SentencingAPI.getSentencingDetails(selectedOffense, modifiers, modifiers.yo);
        const summary = `Sentencing Summary: ${selectedOffense.name}\nSection: ${selectedOffense.section}\nClass: ${selectedOffense.class}\nSentence: ${details.sentenceType} - ${details.range}`;
        navigator.clipboard.writeText(summary);
        alert('Summary copied to clipboard!');
    }
    </script>
</body>
</html>
