<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guilty Plea Colloquy - AI Enhanced</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400..700;1,400..700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        html { scroll-behavior: smooth; }
        body { 
            font-family: 'Lora', serif; 
            background-color: #f8fafc;
        }
        .tool-section { 
            padding-top: 4rem; 
            margin-top: -4rem; 
        }
        .search-container { 
            position: relative; 
        }
        .search-results { 
            position: absolute; 
            top: 100%; 
            left: 0; 
            right: 0; 
            z-index: 1000; 
            max-height: 400px; 
            overflow-y: auto; 
            display: none; 
            background-color: white; 
            border: 1px solid #e2e8f0; 
            border-radius: 0.5rem; 
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05);
        }
        .search-result-item { 
            cursor: pointer; 
            padding: 0.75rem 1rem; 
            border-bottom: 1px solid #f1f5f9;
            transition: background-color 0.2s ease;
        }
        .search-result-item:hover { 
            background-color: #f1f5f9; 
        }
        .search-result-item:last-child {
            border-bottom: none;
        }
        .loading-spinner {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .question-card {
            transition: all 0.2s ease;
        }
        .question-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1);
        }
        .header, h1, h2 { text-align: center; }
    </style>
</head>
<body class="text-gray-800">

    <div class="container mx-auto max-w-6xl my-8 px-4">
        
        <!-- Header -->
        <header class="text-center mb-8">
            <div class="flex items-center justify-center mb-4">
                <i class="fas fa-gavel text-4xl text-slate-600 mr-4"></i>
                <div>
                    <h1 class="text-4xl md:text-5xl font-bold text-slate-800">Guilty Plea Colloquy</h1>
                    <p class="text-lg text-slate-500 mt-2">AI-Enhanced Judicial Assistant</p>
                </div>
            </div>
            <div class="flex justify-center space-x-4 text-sm text-slate-600">
                <span><i class="fas fa-clock mr-1"></i> <span id="current-time"></span></span>
                <span><i class="fas fa-calendar mr-1"></i> <span id="current-date"></span></span>
            </div>
        </header>

        <!-- Offense Selection Section -->
        <section id="offense-selection" class="tool-section mb-8">
            <div class="bg-white rounded-xl shadow-lg border border-slate-300 p-8">
                <div class="flex items-center mb-6">
                    <i class="fas fa-search text-2xl text-indigo-600 mr-3"></i>
                    <h2 class="text-3xl font-semibold text-slate-700">Offense Selection</h2>
                </div>
                
                <div class="search-container">
                    <div class="relative">
                        <input 
                            class="w-full p-4 pl-12 border border-gray-300 rounded-lg text-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200" 
                            type="text" 
                            id="offenseSearch" 
                            placeholder="Search for an offense (e.g., 'assault', 'PL 120.05')..."
                            autocomplete="off"
                            aria-label="Search for offense">
                        <i class="fas fa-search absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                        <div id="search-loading" class="absolute right-4 top-1/2 transform -translate-y-1/2 hidden">
                            <i class="fas fa-spinner loading-spinner text-indigo-600"></i>
                        </div>
                    </div>
                    <div class="search-results" id="searchResults" role="listbox" aria-label="Offense search results"></div>
                </div>

                <!-- Selected Offense Display -->
                <div id="selectedOffense" class="mt-6 p-6 bg-gradient-to-r from-indigo-50 to-blue-50 border border-indigo-200 rounded-lg hidden fade-in">
                    <div class="flex items-start justify-between">
                        <div class="flex-1">
                            <h3 class="text-xl font-semibold text-indigo-800 mb-2" id="offenseName"></h3>
                            <p class="text-indigo-700 mb-3" id="offenseDetails"></p>
                            <div id="offenseBadges" class="flex flex-wrap gap-2 mb-4"></div>
                            <div class="text-sm text-indigo-600">
                                <i class="fas fa-info-circle mr-1"></i>
                                <span id="offenseNotes"></span>
                            </div>
                        </div>
                        <button 
                            id="clearOffense" 
                            class="ml-4 px-3 py-1 text-sm text-red-600 hover:text-red-800 hover:bg-red-50 rounded-md transition-colors duration-200">
                            <i class="fas fa-times mr-1"></i>Clear
                        </button>
                    </div>
                </div>

                <!-- Search Tips -->
                <div class="mt-4 p-4 bg-slate-50 rounded-lg">
                    <h4 class="font-semibold text-slate-700 mb-2"><i class="fas fa-lightbulb mr-2 text-yellow-500"></i>Search Tips</h4>
                    <ul class="text-sm text-slate-600 space-y-1">
                        <li>• Search by offense name (e.g., "assault", "burglary")</li>
                        <li>• Search by Penal Law section (e.g., "PL 120.05", "120.05")</li>
                        <li>• Search by classification (e.g., "felony", "misdemeanor")</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- Plea Type Selection -->
        <section id="plea-type" class="tool-section mb-8">
            <div class="bg-white rounded-xl shadow-lg border border-slate-300 p-8">
                <div class="flex items-center mb-6">
                    <i class="fas fa-list-alt text-2xl text-green-600 mr-3"></i>
                    <h2 class="text-3xl font-semibold text-slate-700">Plea Type</h2>
                </div>
                
                <div class="grid md:grid-cols-2 gap-6">
                    <label class="relative cursor-pointer">
                        <input type="radio" name="pleaType" value="felony" checked class="sr-only">
                        <div class="p-6 border-2 border-gray-200 rounded-lg hover:border-indigo-300 transition-all duration-200 plea-type-card">
                            <div class="flex items-center mb-4">
                                <div class="w-6 h-6 border-2 border-gray-300 rounded-full mr-3 flex items-center justify-center">
                                    <div class="w-3 h-3 bg-indigo-600 rounded-full hidden radio-dot"></div>
                                </div>
                                <h3 class="text-xl font-semibold text-slate-700">Felony Plea</h3>
                            </div>
                            <p class="text-slate-600">Comprehensive colloquy for felony offenses with detailed constitutional rights review.</p>
                            <div class="mt-4 text-sm text-slate-500">
                                <i class="fas fa-check-circle mr-1 text-green-500"></i>
                                Includes all constitutional rights
                            </div>
                        </div>
                    </label>
                    
                    <label class="relative cursor-pointer">
                        <input type="radio" name="pleaType" value="non-felony" class="sr-only">
                        <div class="p-6 border-2 border-gray-200 rounded-lg hover:border-indigo-300 transition-all duration-200 plea-type-card">
                            <div class="flex items-center mb-4">
                                <div class="w-6 h-6 border-2 border-gray-300 rounded-full mr-3 flex items-center justify-center">
                                    <div class="w-3 h-3 bg-indigo-600 rounded-full hidden radio-dot"></div>
                                </div>
                                <h3 class="text-xl font-semibold text-slate-700">Non-Felony Plea</h3>
                            </div>
                            <p class="text-slate-600">Streamlined colloquy for misdemeanor and violation offenses.</p>
                            <div class="mt-4 text-sm text-slate-500">
                                <i class="fas fa-check-circle mr-1 text-green-500"></i>
                                Abbreviated format for efficiency
                            </div>
                        </div>
                    </label>
                </div>
            </div>
        </section>

        <!-- Colloquy Section -->
        <section id="colloquy" class="tool-section mb-8">
            <div class="bg-white rounded-xl shadow-lg border border-slate-300 p-8">
                <div class="flex items-center mb-6">
                    <i class="fas fa-comments text-2xl text-purple-600 mr-3"></i>
                    <h2 class="text-3xl font-semibold text-slate-700">Colloquy Script</h2>
                </div>
                
                <div id="colloquy-content" class="space-y-6">
                    <!-- Colloquy content will be dynamically inserted here -->
                </div>

                <!-- Action Buttons -->
                <div class="flex flex-wrap gap-4 mt-8 pt-6 border-t border-slate-200">
                    <button id="copyColloquy" class="px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors duration-200 flex items-center">
                        <i class="fas fa-copy mr-2"></i>
                        Copy to Clipboard
                    </button>
                    <button id="printColloquy" class="px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors duration-200 flex items-center">
                        <i class="fas fa-print mr-2"></i>
                        Print Script
                    </button>
                    <button id="resetColloquy" class="px-6 py-3 bg-slate-600 text-white rounded-lg hover:bg-slate-700 transition-colors duration-200 flex items-center">
                        <i class="fas fa-redo mr-2"></i>
                        Reset
                    </button>
                </div>
            </div>
        </section>

        <!-- AI Assistant Section -->
        <section id="ai-assistant" class="tool-section mb-8">
            <div class="bg-white rounded-xl shadow-lg border border-slate-300 p-8">
                <div class="flex items-center mb-6">
                    <i class="fas fa-robot text-2xl text-blue-600 mr-3"></i>
                    <h2 class="text-3xl font-semibold text-slate-700">AI Legal Assistant</h2>
                </div>
                
                <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-6 rounded-lg">
                    <div class="flex items-start space-x-4">
                        <div class="flex-shrink-0">
                            <i class="fas fa-lightbulb text-2xl text-blue-600"></i>
                        </div>
                        <div class="flex-1">
                            <h3 class="text-lg font-semibold text-slate-700 mb-2">Context-Aware Recommendations</h3>
                            <p class="text-slate-600 mb-4">The AI assistant analyzes your selected offense and plea type to provide tailored legal guidance and procedural recommendations.</p>
                            <div id="ai-recommendations" class="space-y-3">
                                <!-- AI recommendations will be inserted here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Success Toast -->
    <div id="success-toast" class="fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg transform translate-x-full transition-transform duration-300 z-50">
        <div class="flex items-center">
            <i class="fas fa-check-circle mr-2"></i>
            <span id="toast-message">Action completed successfully!</span>
        </div>
    </div>

    <script>
        // Configuration
        const CONFIG = {
            API_BASE: 'https://platforms.cc',
            SENTENCING_API_BASE: 'https://sentencing-api-583372391636.us-central1.run.app',
            SEARCH_DELAY: 300,
            MAX_SEARCH_RESULTS: 10
        };

        // State management
        const state = {
            selectedOffense: null,
            pleaType: 'felony',
            searchTimeout: null,
            isLoading: false
        };

        // Colloquy data
        // Embed JSON directly for offline use
        const COLLOQUY_DATA = {
            felony: {
                "title": "GUILTY PLEA COLLOQUY",
                "publication_date": "Published Aug. 2016",
                "table_of_contents": [
                    { "title": "INTRODUCTION", "anchor": "#introduction" },
                    { "title": "WAIVER OF INDICTMENT FOR SCI", "anchor": "#waiver_of_indictment" },
                    { "title": "MOTION BY DEFENSE TO PLEAD GUILTY", "anchor": "#motion_to_plead" },
                    { "title": "WAIVED OR FORFEITED RIGHTS", "anchor": "#waived_rights", "children": [
                        { "title": "Trial by Jury Waived", "anchor": "#jury_trial_waiver" },
                        { "title": "Right to Appeal Waived", "anchor": "#appeal_waiver" }
                    ] },
                    { "title": "Determinate sentence [if applicable]", "anchor": "#determinate_sentence" },
                    { "title": "Revocable Sentence", "anchor": "#revocable_sentence" },
                    { "title": "Driving While Intoxicated Conditions", "anchor": "#dwi_conditions" },
                    { "title": "License Revocation", "anchor": "#license_revocation", "children": [
                        { "title": "For Driving While Intoxicated", "anchor": "#dwi_revocation" },
                        { "title": "For other Offenses", "anchor": "#other_offense_revocation" }
                    ] },
                    { "title": "ADVICE", "anchor": "#advice", "children": [
                        { "title": "Conditional Sentence Promise Explained", "anchor": "#conditional_sentence" },
                        { "title": "Sex Offense - Civil Commitment", "anchor": "#sex_offense_civil_commitment" },
                        { "title": "Deportation", "anchor": "#deportation" },
                        { "title": "Right to Vote", "anchor": "#right_to_vote" },
                        { "title": "Sex Offense Registration", "anchor": "#sex_offense_registration" }
                    ] },
                    { "title": "SEX OFFENSE WITH STATE PRISON", "anchor": "#sex_offense_state_prison" },
                    { "title": "Waiver of Discovery", "anchor": "#waiver_of_discovery" },
                    { "title": "CONDITIONS OF RELEASE BEFORE SENTENCE", "anchor": "#conditions_of_release" },
                    { "title": "VOLUNTARINESS", "anchor": "#voluntariness" },
                    { "title": "CONCLUSION", "anchor": "#conclusion" },
                    { "title": "ARRAIGNMENT OF THE DEFENDANT ON A PREDICATE FELONY STATEMENT", "anchor": "#predicate_felony_arraignment" }
                ],
                "sections": [
                    {
                        "id": "introduction",
                        "title": "INTRODUCTION",
                        "content": [
                            { "type": "dialogue", "speaker": "Assistant", "lines": ["Welcome to the Guilty Plea Colloquy. This tool is designed to assist you in navigating the legal process of pleading guilty."] },
                            { "type": "dialogue", "speaker": "Assistant", "lines": ["Please select an offense and plea type to begin."] }
                        ]
                    },
                    {
                        "id": "waiver_of_indictment",
                        "title": "WAIVER OF INDICTMENT FOR SCI",
                        "content": [
                            { "type": "dialogue", "speaker": "Assistant", "lines": ["Before we proceed, it's important to understand that a waiver of indictment for SCI (Sexual Conduct Against Minors) is a significant legal step."] },
                            { "type": "dialogue", "speaker": "Assistant", "lines": ["This waiver allows the prosecution to proceed directly to indictment, bypassing the grand jury process. This is typically done in cases where the defendant has a strong alibi or where the evidence is overwhelming."] },
                            { "type": "dialogue", "speaker": "Assistant", "lines": ["If you are a defendant in a SCI case, you must be aware of the consequences of waiving indictment."] }
                        ]
                    },
                    {
                        "id": "motion_to_plead",
                        "title": "MOTION BY DEFENSE TO PLEAD GUILTY",
                        "content": [
                            { "type": "dialogue", "speaker": "Assistant", "lines": ["The defense has the right to move to plead guilty. This motion must be made in writing and filed with the court."] },
                            { "type": "dialogue", "speaker": "Assistant", "lines": ["The defense must state the specific charges and the plea of guilty."] },
                            { "type": "dialogue", "speaker": "Assistant", "lines": ["The defense must state the specific facts constituting the offense charged."] }
                        ]
                    },
                    {
                        "id": "waived_rights",
                        "title": "WAIVED OR FORFEITED RIGHTS",
                        "children": [
                            {
                                "id": "jury_trial_waiver",
                                "title": "Trial by Jury Waived",
                                "content": [
                                    { "type": "dialogue", "speaker": "Assistant", "lines": ["The defendant has waived their right to a jury trial."] },
                                    { "type": "dialogue", "speaker": "Assistant", "lines": ["This waiver must be made in writing and filed with the court."] }
                                ]
                            },
                            {
                                "id": "appeal_waiver",
                                "title": "Right to Appeal Waived",
                                "content": [
                                    { "type": "dialogue", "speaker": "Assistant", "lines": ["The defendant has waived their right to appeal."] },
                                    { "type": "dialogue", "speaker": "Assistant", "lines": ["This waiver must be made in writing and filed with the court."] }
                                ]
                            }
                        ]
                    },
                    {
                        "id": "determinate_sentence",
                        "title": "Determinate sentence [if applicable]",
                        "content": [
                            { "type": "dialogue", "speaker": "Assistant", "lines": ["If the offense is punishable by a determinate sentence, the defendant must state the specific sentence they are pleading guilty to."] },
                            { "type": "dialogue", "speaker": "Assistant", "lines": ["This includes the specific term of imprisonment, probation, or any other form of punishment."] }
                        ]
                    },
                    {
                        "id": "revocable_sentence",
                        "title": "Revocable Sentence",
                        "content": [
                            { "type": "dialogue", "speaker": "Assistant", "lines": ["A revocable sentence is one that can be modified or revoked by the court after sentencing."] },
                            { "type": "dialogue", "speaker": "Assistant", "lines": ["This is typically reserved for cases where the sentence is unusually harsh or where the defendant has demonstrated exceptional circumstances."] }
                        ]
                    },
                    {
                        "id": "dwi_conditions",
                        "title": "Driving While Intoxicated Conditions",
                        "content": [
                            { "type": "dialogue", "speaker": "Assistant", "lines": ["If the offense is Driving While Intoxicated (DUI), the defendant must state the specific conditions of their release."] },
                            { "type": "dialogue", "speaker": "Assistant", "lines": ["This includes the specific terms of probation, parole, or any other conditions of release."] }
                        ]
                    },
                    {
                        "id": "license_revocation",
                        "title": "License Revocation",
                        "children": [
                            {
                                "id": "dwi_revocation",
                                "title": "For Driving While Intoxicated",
                                "content": [
                                    { "type": "dialogue", "speaker": "Assistant", "lines": ["If the offense is Driving While Intoxicated (DUI), the defendant must state the specific conditions of license revocation."] },
                                    { "type": "dialogue", "speaker": "Assistant", "lines": ["This includes the specific terms of license suspension or revocation."] }
                                ]
                            },
                            {
                                "id": "other_offense_revocation",
                                "title": "For other Offenses",
                                "content": [
                                    { "type": "dialogue", "speaker": "Assistant", "lines": ["If the offense is not a DUI, the defendant must state the specific conditions of license revocation."] },
                                    { "type": "dialogue", "speaker": "Assistant", "lines": ["This includes the specific terms of license suspension or revocation."] }
                                ]
                            }
                        ]
                    },
                    {
                        "id": "advice",
                        "title": "ADVICE",
                        "children": [
                            {
                                "id": "conditional_sentence",
                                "title": "Conditional Sentence Promise Explained",
                                "content": [
                                    { "type": "dialogue", "speaker": "Assistant", "lines": ["The defendant must understand that a conditional sentence is a promise to the court that they will not commit any further crimes if released on probation."] },
                                    { "type": "dialogue", "speaker": "Assistant", "lines": ["This is a serious commitment and must be taken seriously."] }
                                ]
                            },
                            {
                                "id": "sex_offense_civil_commitment",
                                "title": "Sex Offense - Civil Commitment",
                                "content": [
                                    { "type": "dialogue", "speaker": "Assistant", "lines": ["If the offense is a Sex Offense, the defendant must understand that they may be subject to civil commitment by the state."] },
                                    { "type": "dialogue", "speaker": "Assistant", "lines": ["This is a legal process that allows the state to involuntarily commit an individual for treatment for a mental illness or disorder."] }
                                ]
                            },
                            {
                                "id": "deportation",
                                "title": "Deportation",
                                "content": [
                                    { "type": "dialogue", "speaker": "Assistant", "lines": ["If the offense is a deportable offense, the defendant must understand that they may be subject to deportation."] },
                                    { "type": "dialogue", "speaker": "Assistant", "lines": ["This is a legal process that allows the federal government to remove an individual from the country."] }
                                ]
                            },
                            {
                                "id": "right_to_vote",
                                "title": "Right to Vote",
                                "content": [
                                    { "type": "dialogue", "speaker": "Assistant", "lines": ["The defendant must understand that they have the right to vote in future elections."] }
                                ]
                            },
                            {
                                "id": "sex_offense_registration",
                                "title": "Sex Offense Registration",
                                "content": [
                                    { "type": "dialogue", "speaker": "Assistant", "lines": ["If the offense is a Sex Offense, the defendant must understand that they must register with the state as a sex offender."] },
                                    { "type": "dialogue", "speaker": "Assistant", "lines": ["This is a legal requirement that allows the state to monitor and track individuals convicted of sex offenses."] }
                                ]
                            }
                        ]
                    },
                    {
                        "id": "sex_offense_state_prison",
                        "title": "SEX OFFENSE WITH STATE PRISON",
                        "content": [
                            { "type": "dialogue", "speaker": "Assistant", "lines": ["If the offense is a Sex Offense, the defendant must understand that they may be sentenced to state prison."] }
                        ]
                    },
                    {
                        "id": "waiver_of_discovery",
                        "title": "Waiver of Discovery",
                        "content": [
                            { "type": "dialogue", "speaker": "Assistant", "lines": ["The defendant must understand that they have waived their right to discovery."] },
                            { "type": "dialogue", "speaker": "Assistant", "lines": ["This means they cannot request information from the prosecution that is not already in the public record."] }
                        ]
                    },
                    {
                        "id": "conditions_of_release",
                        "title": "CONDITIONS OF RELEASE BEFORE SENTENCE",
                        "content": [
                            { "type": "dialogue", "speaker": "Assistant", "lines": ["The defendant must understand the conditions of their release before sentencing."] },
                            { "type": "dialogue", "speaker": "Assistant", "lines": ["This includes any probation, parole, or other conditions of release."] }
                        ]
                    },
                    {
                        "id": "voluntariness",
                        "title": "VOLUNTARINESS",
                        "content": [
                            { "type": "dialogue", "speaker": "Assistant", "lines": ["The defendant must understand that they are pleading guilty voluntarily."] },
                            { "type": "dialogue", "speaker": "Assistant", "lines": ["This means they are not being coerced or forced to plead guilty."] }
                        ]
                    },
                    {
                        "id": "conclusion",
                        "title": "CONCLUSION",
                        "content": [
                            { "type": "dialogue", "speaker": "Assistant", "lines": ["The defendant must understand that they are pleading guilty to the charges as presented."] },
                            { "type": "dialogue", "speaker": "Assistant", "lines": ["They must acknowledge that they are guilty of the offense(s) charged."] }
                        ]
                    },
                    {
                        "id": "predicate_felony_arraignment",
                        "title": "ARRAIGNMENT OF THE DEFENDANT ON A PREDICATE FELONY STATEMENT",
                        "content": [
                            { "type": "dialogue", "speaker": "Assistant", "lines": ["The defendant must be arraigned on a predicate felony statement."] },
                            { "type": "dialogue", "speaker": "Assistant", "lines": ["This is the formal statement of the charges and the plea of guilty."] }
                        ]
                    }
                ],
                "endnotes": []
            },
            non_felony: {
                "title": "ABBREVIATED COLLOQUY FOR A NON-FELONY",
                "publication_note": "Added June, 2017",
                "sections": [
                    {
                        "id": "introduction",
                        "title": "INTRODUCTION",
                        "content": [
                            { "type": "dialogue", "speaker": "Assistant", "lines": ["Welcome to the Guilty Plea Colloquy. This tool is designed to assist you in navigating the legal process of pleading guilty."] },
                            { "type": "dialogue", "speaker": "Assistant", "lines": ["Please select an offense and plea type to begin."] }
                        ]
                    },
                    {
                        "id": "waiver_of_indictment",
                        "title": "WAIVER OF INDICTMENT FOR SCI",
                        "content": [
                            { "type": "dialogue", "speaker": "Assistant", "lines": ["Before we proceed, it's important to understand that a waiver of indictment for SCI (Sexual Conduct Against Minors) is a significant legal step."] },
                            { "type": "dialogue", "speaker": "Assistant", "lines": ["This waiver allows the prosecution to proceed directly to indictment, bypassing the grand jury process. This is typically done in cases where the defendant has a strong alibi or where the evidence is overwhelming."] },
                            { "type": "dialogue", "speaker": "Assistant", "lines": ["If you are a defendant in a SCI case, you must be aware of the consequences of waiving indictment."] }
                        ]
                    },
                    {
                        "id": "motion_to_plead",
                        "title": "MOTION BY DEFENSE TO PLEAD GUILTY",
                        "content": [
                            { "type": "dialogue", "speaker": "Assistant", "lines": ["The defense has the right to move to plead guilty. This motion must be made in writing and filed with the court."] },
                            { "type": "dialogue", "speaker": "Assistant", "lines": ["The defense must state the specific charges and the plea of guilty."] },
                            { "type": "dialogue", "speaker": "Assistant", "lines": ["The defense must state the specific facts constituting the offense charged."] }
                        ]
                    },
                    {
                        "id": "waived_rights",
                        "title": "WAIVED OR FORFEITED RIGHTS",
                        "children": [
                            {
                                "id": "jury_trial_waiver",
                                "title": "Trial by Jury Waived",
                                "content": [
                                    { "type": "dialogue", "speaker": "Assistant", "lines": ["The defendant has waived their right to a jury trial."] },
                                    { "type": "dialogue", "speaker": "Assistant", "lines": ["This waiver must be made in writing and filed with the court."] }
                                ]
                            },
                            {
                                "id": "appeal_waiver",
                                "title": "Right to Appeal Waived",
                                "content": [
                                    { "type": "dialogue", "speaker": "Assistant", "lines": ["The defendant has waived their right to appeal."] },
                                    { "type": "dialogue", "speaker": "Assistant", "lines": ["This waiver must be made in writing and filed with the court."] }
                                ]
                            }
                        ]
                    },
                    {
                        "id": "determinate_sentence",
                        "title": "Determinate sentence [if applicable]",
                        "content": [
                            { "type": "dialogue", "speaker": "Assistant", "lines": ["If the offense is punishable by a determinate sentence, the defendant must state the specific sentence they are pleading guilty to."] },
                            { "type": "dialogue", "speaker": "Assistant", "lines": ["This includes the specific term of imprisonment, probation, or any other form of punishment."] }
                        ]
                    },
                    {
                        "id": "revocable_sentence",
                        "title": "Revocable Sentence",
                        "content": [
                            { "type": "dialogue", "speaker": "Assistant", "lines": ["A revocable sentence is one that can be modified or revoked by the court after sentencing."] },
                            { "type": "dialogue", "speaker": "Assistant", "lines": ["This is typically reserved for cases where the sentence is unusually harsh or where the defendant has demonstrated exceptional circumstances."] }
                        ]
                    },
                    {
                        "id": "dwi_conditions",
                        "title": "Driving While Intoxicated Conditions",
                        "content": [
                            { "type": "dialogue", "speaker": "Assistant", "lines": ["If the offense is Driving While Intoxicated (DUI), the defendant must state the specific conditions of their release."] },
                            { "type": "dialogue", "speaker": "Assistant", "lines": ["This includes the specific terms of probation, parole, or any other conditions of release."] }
                        ]
                    },
                    {
                        "id": "license_revocation",
                        "title": "License Revocation",
                        "children": [
                            {
                                "id": "dwi_revocation",
                                "title": "For Driving While Intoxicated",
                                "content": [
                                    { "type": "dialogue", "speaker": "Assistant", "lines": ["If the offense is Driving While Intoxicated (DUI), the defendant must state the specific conditions of license revocation."] },
                                    { "type": "dialogue", "speaker": "Assistant", "lines": ["This includes the specific terms of license suspension or revocation."] }
                                ]
                            },
                            {
                                "id": "other_offense_revocation",
                                "title": "For other Offenses",
                                "content": [
                                    { "type": "dialogue", "speaker": "Assistant", "lines": ["If the offense is not a DUI, the defendant must state the specific conditions of license revocation."] },
                                    { "type": "dialogue", "speaker": "Assistant", "lines": ["This includes the specific terms of license suspension or revocation."] }
                                ]
                            }
                        ]
                    },
                    {
                        "id": "advice",
                        "title": "ADVICE",
                        "children": [
                            {
                                "id": "conditional_sentence",
                                "title": "Conditional Sentence Promise Explained",
                                "content": [
                                    { "type": "dialogue", "speaker": "Assistant", "lines": ["The defendant must understand that a conditional sentence is a promise to the court that they will not commit any further crimes if released on probation."] },
                                    { "type": "dialogue", "speaker": "Assistant", "lines": ["This is a serious commitment and must be taken seriously."] }
                                ]
                            },
                            {
                                "id": "sex_offense_civil_commitment",
                                "title": "Sex Offense - Civil Commitment",
                                "content": [
                                    { "type": "dialogue", "speaker": "Assistant", "lines": ["If the offense is a Sex Offense, the defendant must understand that they may be subject to civil commitment by the state."] },
                                    { "type": "dialogue", "speaker": "Assistant", "lines": ["This is a legal process that allows the state to involuntarily commit an individual for treatment for a mental illness or disorder."] }
                                ]
                            },
                            {
                                "id": "deportation",
                                "title": "Deportation",
                                "content": [
                                    { "type": "dialogue", "speaker": "Assistant", "lines": ["If the offense is a deportable offense, the defendant must understand that they may be subject to deportation."] },
                                    { "type": "dialogue", "speaker": "Assistant", "lines": ["This is a legal process that allows the federal government to remove an individual from the country."] }
                                ]
                            },
                            {
                                "id": "right_to_vote",
                                "title": "Right to Vote",
                                "content": [
                                    { "type": "dialogue", "speaker": "Assistant", "lines": ["The defendant must understand that they have the right to vote in future elections."] }
                                ]
                            },
                            {
                                "id": "sex_offense_registration",
                                "title": "Sex Offense Registration",
                                "content": [
                                    { "type": "dialogue", "speaker": "Assistant", "lines": ["If the offense is a Sex Offense, the defendant must understand that they must register with the state as a sex offender."] },
                                    { "type": "dialogue", "speaker": "Assistant", "lines": ["This is a legal requirement that allows the state to monitor and track individuals convicted of sex offenses."] }
                                ]
                            }
                        ]
                    },
                    {
                        "id": "sex_offense_state_prison",
                        "title": "SEX OFFENSE WITH STATE PRISON",
                        "content": [
                            { "type": "dialogue", "speaker": "Assistant", "lines": ["If the offense is a Sex Offense, the defendant must understand that they may be sentenced to state prison."] }
                        ]
                    },
                    {
                        "id": "waiver_of_discovery",
                        "title": "Waiver of Discovery",
                        "content": [
                            { "type": "dialogue", "speaker": "Assistant", "lines": ["The defendant must understand that they have waived their right to discovery."] },
                            { "type": "dialogue", "speaker": "Assistant", "lines": ["This means they cannot request information from the prosecution that is not already in the public record."] }
                        ]
                    },
                    {
                        "id": "conditions_of_release",
                        "title": "CONDITIONS OF RELEASE BEFORE SENTENCE",
                        "content": [
                            { "type": "dialogue", "speaker": "Assistant", "lines": ["The defendant must understand the conditions of their release before sentencing."] },
                            { "type": "dialogue", "speaker": "Assistant", "lines": ["This includes any probation, parole, or other conditions of release."] }
                        ]
                    },
                    {
                        "id": "voluntariness",
                        "title": "VOLUNTARINESS",
                        "content": [
                            { "type": "dialogue", "speaker": "Assistant", "lines": ["The defendant must understand that they are pleading guilty voluntarily."] },
                            { "type": "dialogue", "speaker": "Assistant", "lines": ["This means they are not being coerced or forced to plead guilty."] }
                        ]
                    },
                    {
                        "id": "conclusion",
                        "title": "CONCLUSION",
                        "content": [
                            { "type": "dialogue", "speaker": "Assistant", "lines": ["The defendant must understand that they are pleading guilty to the charges as presented."] },
                            { "type": "dialogue", "speaker": "Assistant", "lines": ["They must acknowledge that they are guilty of the offense(s) charged."] }
                        ]
                    },
                    {
                        "id": "predicate_felony_arraignment",
                        "title": "ARRAIGNMENT OF THE DEFENDANT ON A PREDICATE FELONY STATEMENT",
                        "content": [
                            { "type": "dialogue", "speaker": "Assistant", "lines": ["The defendant must be arraigned on a predicate felony statement."] },
                            { "type": "dialogue", "speaker": "Assistant", "lines": ["This is the formal statement of the charges and the plea of guilty."] }
                        ]
                    }
                ]
            }
        };

        // Renderers for each colloquy type
        function renderFelonyColloquy(colloquy) {
            // Render sections and subsections recursively
            function renderSection(section, idxPrefix = '') {
                let html = '';
                const index = idxPrefix ? idxPrefix : '';
                html += `<div class="question-card bg-slate-50 rounded-lg p-6 border border-slate-200 mb-4">`;
                html += `<h3 class="text-lg font-semibold text-slate-700 mb-2">${section.title || ''}</h3>`;
                if (section.content) {
                    section.content.forEach(item => {
                        if (item.type === 'dialogue') {
                            html += `<div class="mb-2"><span class="font-semibold text-indigo-700">${item.speaker}:</span><ul class="ml-6 list-disc">`;
                            item.lines.forEach(line => {
                                html += `<li class="text-slate-700">${line}</li>`;
                            });
                            html += `</ul></div>`;
                        } else if (item.type === 'dialogue_options') {
                            html += `<div class="mb-2"><span class="font-semibold text-indigo-700">${item.speaker} (Conditional):</span><ul class="ml-6 list-disc">`;
                            item.options.forEach(line => {
                                html += `<li class="text-slate-700">${line}</li>`;
                            });
                            html += `</ul></div>`;
                        } else if (item.type === 'conditional_dialogue') {
                            html += `<div class="mb-2"><span class="font-semibold text-indigo-700">${item.dialogue.speaker} (Condition: ${item.condition}):</span><ul class="ml-6 list-disc">`;
                            item.dialogue.lines.forEach(line => {
                                html += `<li class="text-slate-700">${line}</li>`;
                            });
                            html += `</ul></div>`;
                        } else if (item.type === 'question') {
                            html += `<div class="mb-2"><span class="font-semibold text-indigo-700">Question:</span> <span class="text-slate-700">${item.text}</span></div>`;
                        } else if (item.type === 'statement') {
                            html += `<div class="mb-2"><span class="font-semibold text-green-700">Statement:</span> <span class="text-slate-700">${item.text}</span></div>`;
                        } else if (item.type === 'explanation') {
                            html += `<div class="mb-2"><span class="font-semibold text-blue-700">Explanation:</span> <span class="text-slate-700">${item.title || ''}</span>`;
                            if (item.points) {
                                html += `<ul class="ml-6 list-disc">`;
                                item.points.forEach(pt => {
                                    html += `<li class="text-slate-700">${pt}</li>`;
                                });
                                html += `</ul>`;
                            }
                            html += `</div>`;
                        } else if (item.type === 'list') {
                            html += `<ul class="ml-6 list-disc">`;
                            item.items.forEach(pt => {
                                html += `<li class="text-slate-700">${pt}</li>`;
                            });
                            html += `</ul>`;
                        } else if (item.type === 'note') {
                            html += `<div class="mb-2 italic text-slate-500">Note: ${item.text}</div>`;
                        } else if (item.type === 'instruction') {
                            html += `<div class="mb-2 text-slate-600">Instruction: ${item.text}</div>`;
                        }
                    });
                }
                // Render subsections recursively
                if (section.children) { // Changed from subsections to children
                    section.children.forEach((sub, i) => {
                        html += renderSection(sub, index + (i+1) + '.');
                    });
                }
                return html + '</div>';
            }
            // Render all top-level sections
            return colloquy.sections.map((section, i) => renderSection(section, (i+1) + '.')).join('');
        }

        function renderNonFelonyColloquy(colloquy) {
            // Render abbreviated questions
            function renderSection(section) {
                let html = '';
                if (section.content) {
                    section.content.forEach(item => {
                        if (item.type === 'question' || item.type === 'conditional_question') {
                            const q = item.type === 'conditional_question' ? item.question : item;
                            html += `<div class="question-card bg-slate-50 rounded-lg p-6 border border-slate-200 mb-4">`;
                            html += `<h3 class="text-lg font-semibold text-slate-700 mb-2">Colloquy Question</h3>`;
                            html += `<div class="text-slate-700">${q.text}</div>`;
                            if (q.is_recommended) {
                                html += `<div class="text-xs text-green-700 mt-2">Recommended</div>`;
                            }
                            html += `</div>`;
                        } else if (item.type === 'statement') {
                            html += `<div class="question-card bg-slate-50 rounded-lg p-6 border border-slate-200 mb-4">`;
                            html += `<h3 class="text-lg font-semibold text-slate-700 mb-2">Court Statement</h3>`;
                            html += `<div class="text-slate-700">${item.text}</div></div>`;
                        }
                    });
                }
                return html;
            }
            // Only render the main colloquy section
            const mainSection = colloquy.sections.find(s => s.id === 'colloquy_questions');
            return mainSection ? renderSection(mainSection) : '';
        }

        // Utility functions
        const utils = {
            debounce(func, wait) {
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(state.searchTimeout);
                        func(...args);
                    };
                    clearTimeout(state.searchTimeout);
                    state.searchTimeout = setTimeout(later, wait);
                };
            },

            showToast(message, type = 'success') {
                const toast = document.getElementById('success-toast');
                const messageEl = document.getElementById('toast-message');
                messageEl.textContent = message;
                toast.classList.remove('translate-x-full');
                setTimeout(() => {
                    toast.classList.add('translate-x-full');
                }, 3000);
            },

            updateDateTime() {
                const now = new Date();
                document.getElementById('current-time').textContent = now.toLocaleTimeString();
                document.getElementById('current-date').textContent = now.toLocaleDateString();
            }
        };

        // API client
        const apiClient = {
            async searchOffenses(query) {
                try {
                    const response = await fetch(`${CONFIG.API_BASE}/api/offenses/search?q=${encodeURIComponent(query)}&limit=${CONFIG.MAX_SEARCH_RESULTS}`);
                    if (!response.ok) {
                        throw new Error(`API Error: ${response.status}`);
                    }
                    return await response.json();
                } catch (error) {
                    console.error('Search API error:', error);
                    throw error;
                }
            },

            async getSentencingRecommendations(offense) {
                try {
                    const response = await fetch(`${CONFIG.SENTENCING_API_BASE}/api/sentencing/recommendations`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            offense: offense.name,
                            section: offense.section,
                            classification: offense.class
                        })
                    });
                    if (!response.ok) {
                        throw new Error(`Sentencing API Error: ${response.status}`);
                    }
                    return await response.json();
                } catch (error) {
                    console.error('Sentencing API error:', error);
                    return null;
                }
            }
        };

        // Search functionality
        const searchManager = {
            init() {
                const searchInput = document.getElementById('offenseSearch');
                const searchResults = document.getElementById('searchResults');
                const searchLoading = document.getElementById('search-loading');

                searchInput.addEventListener('input', utils.debounce(async (e) => {
                    const query = e.target.value.trim();
                    if (query.length < 2) {
                        searchResults.style.display = 'none';
                        return;
                    }

                    try {
                        state.isLoading = true;
                        searchLoading.classList.remove('hidden');
                        searchResults.style.display = 'none';

                        const results = await apiClient.searchOffenses(query);
                        this.displayResults(results, query);
                    } catch (error) {
                        this.displayError(error.message);
                    } finally {
                        state.isLoading = false;
                        searchLoading.classList.add('hidden');
                    }
                }, CONFIG.SEARCH_DELAY));

                // Handle keyboard navigation
                searchInput.addEventListener('keydown', (e) => {
                    const results = searchResults.querySelectorAll('.search-result-item');
                    const activeIndex = Array.from(results).findIndex(item => item.classList.contains('bg-indigo-100'));

                    if (e.key === 'ArrowDown') {
                        e.preventDefault();
                        this.navigateResults(1, activeIndex, results);
                    } else if (e.key === 'ArrowUp') {
                        e.preventDefault();
                        this.navigateResults(-1, activeIndex, results);
                    } else if (e.key === 'Enter') {
                        e.preventDefault();
                        const activeItem = searchResults.querySelector('.bg-indigo-100');
                        if (activeItem) {
                            this.selectOffense(JSON.parse(activeItem.dataset.offense));
                        }
                    } else if (e.key === 'Escape') {
                        searchResults.style.display = 'none';
                    }
                });

                // Close search results when clicking outside
                document.addEventListener('click', (e) => {
                    if (!searchInput.contains(e.target) && !searchResults.contains(e.target)) {
                        searchResults.style.display = 'none';
                    }
                });
            },

            displayResults(results, query) {
                const searchResults = document.getElementById('searchResults');
                
                if (!results || results.length === 0) {
                    searchResults.innerHTML = `
                        <div class="search-result-item text-slate-500">
                            <i class="fas fa-info-circle mr-2"></i>
                            No offenses found for "${query}"
                        </div>
                    `;
                } else {
                    searchResults.innerHTML = results.map(offense => `
                        <div class="search-result-item hover:bg-indigo-50 transition-colors duration-200" 
                             data-offense='${JSON.stringify(offense)}'
                             onclick="searchManager.selectOffense(${JSON.stringify(offense).replace(/"/g, '&quot;')})">
                            <div class="font-semibold text-slate-700">${offense.name}</div>
                            <div class="text-sm text-slate-500">${offense.section} • ${offense.class}</div>
                        </div>
                    `).join('');
                }
                
                searchResults.style.display = 'block';
            },

            displayError(message) {
                const searchResults = document.getElementById('searchResults');
                searchResults.innerHTML = `
                    <div class="search-result-item text-red-600">
                        <i class="fas fa-exclamation-triangle mr-2"></i>
                        ${message}
                    </div>
                `;
                searchResults.style.display = 'block';
            },

            navigateResults(direction, currentIndex, results) {
                const newIndex = Math.max(0, Math.min(results.length - 1, currentIndex + direction));
                results.forEach((item, index) => {
                    item.classList.toggle('bg-indigo-100', index === newIndex);
                });
            },

            selectOffense(offense) {
                state.selectedOffense = offense;
                this.displaySelectedOffense(offense);
                document.getElementById('searchResults').style.display = 'none';
                document.getElementById('offenseSearch').value = offense.name;
                colloquyManager.loadColloquy(state.pleaType);
                aiManager.updateRecommendations(offense);
            },

            displaySelectedOffense(offense) {
                const container = document.getElementById('selectedOffense');
                const nameEl = document.getElementById('offenseName');
                const detailsEl = document.getElementById('offenseDetails');
                const badgesEl = document.getElementById('offenseBadges');
                const notesEl = document.getElementById('offenseNotes');

                nameEl.textContent = offense.name;
                detailsEl.textContent = `${offense.section} - ${offense.class}`;
                
                badgesEl.innerHTML = `
                    <span class="px-2 py-1 bg-indigo-100 text-indigo-800 text-xs rounded-full">${offense.class}</span>
                    <span class="px-2 py-1 bg-slate-100 text-slate-800 text-xs rounded-full">${offense.section}</span>
                `;
                
                notesEl.textContent = `Selected for ${state.pleaType} plea colloquy`;
                container.classList.remove('hidden');
            }
        };

        // Colloquy manager
        const colloquyManager = {
            init() {
                // Initialize plea type selection
                document.querySelectorAll('input[name="pleaType"]').forEach(radio => {
                    radio.addEventListener('change', (e) => {
                        state.pleaType = e.target.value;
                        this.loadColloquy(state.pleaType);
                        this.updatePleaTypeUI();
                    });
                });

                // Initialize action buttons
                document.getElementById('copyColloquy').addEventListener('click', () => this.copyToClipboard());
                document.getElementById('printColloquy').addEventListener('click', () => this.printScript());
                document.getElementById('resetColloquy').addEventListener('click', () => this.reset());

                // Initialize clear offense button
                document.getElementById('clearOffense').addEventListener('click', () => this.clearOffense());

                // Load initial colloquy
                this.loadColloquy(state.pleaType);
                this.updatePleaTypeUI();
            },

            loadColloquy(type) {
                const container = document.getElementById('colloquy-content');
                if (type === 'felony') {
                    container.innerHTML = renderFelonyColloquy(COLLOQUY_DATA.felony);
                } else {
                    container.innerHTML = renderNonFelonyColloquy(COLLOQUY_DATA.non_felony);
                }
            },

            updatePleaTypeUI() {
                document.querySelectorAll('.plea-type-card').forEach(card => {
                    const radio = card.querySelector('input[type="radio"]');
                    const dot = card.querySelector('.radio-dot');
                    if (radio.value === state.pleaType) {
                        card.classList.add('border-indigo-500', 'bg-indigo-50');
                        dot.classList.remove('hidden');
                    } else {
                        card.classList.remove('border-indigo-500', 'bg-indigo-50');
                        dot.classList.add('hidden');
                    }
                });
            },

            copyToClipboard() {
                const colloquyText = this.getColloquyText();
                navigator.clipboard.writeText(colloquyText).then(() => {
                    utils.showToast('Colloquy copied to clipboard!');
                }).catch(() => {
                    utils.showToast('Failed to copy to clipboard', 'error');
                });
            },

            printScript() {
                const printWindow = window.open('', '_blank');
                const colloquyText = this.getColloquyText();
                
                printWindow.document.write(`
                    <html>
                        <head>
                            <title>Guilty Plea Colloquy</title>
                            <style>
                                body { font-family: Arial, sans-serif; margin: 40px; }
                                .header { text-align: center; margin-bottom: 30px; }
                                .question { margin-bottom: 20px; }
                                .question-number { font-weight: bold; color: #4f46e5; }
                                .question-text { margin-left: 20px; }
                                .follow-up { margin-left: 40px; color: #666; }
                            </style>
                        </head>
                        <body>
                            <div class="header">
                                <h1>Guilty Plea Colloquy</h1>
                                <p>${state.selectedOffense ? `Offense: ${state.selectedOffense.name} (${state.selectedOffense.section})` : 'No offense selected'}</p>
                                <p>Plea Type: ${state.pleaType === 'felony' ? 'Felony' : 'Non-Felony'}</p>
                                <p>Date: ${new Date().toLocaleDateString()}</p>
                            </div>
                            <div class="content">
                                ${colloquyText.split('\n').map(line => `<p>${line}</p>`).join('')}
                            </div>
                        </body>
                    </html>
                `);
                
                printWindow.document.close();
                printWindow.print();
            },

            getColloquyText() {
                const questions = COLLOQUY_DATA[state.pleaType] || COLLOQUY_DATA.felony;
                let text = `GUILTY PLEA COLLOQUY\n`;
                text += `Date: ${new Date().toLocaleDateString()}\n`;
                text += `Plea Type: ${state.pleaType === 'felony' ? 'Felony' : 'Non-Felony'}\n`;
                if (state.selectedOffense) {
                    text += `Offense: ${state.selectedOffense.name} (${state.selectedOffense.section})\n`;
                }
                text += `\n`;
                
                questions.forEach((item, index) => {
                    text += `${index + 1}. ${item.category}\n`;
                    text += `   Q: ${item.question}\n`;
                    if (item.followUp) {
                        text += `   Q: ${item.followUp}\n`;
                    }
                    text += `\n`;
                });
                
                return text;
            },

            reset() {
                state.selectedOffense = null;
                document.getElementById('selectedOffense').classList.add('hidden');
                document.getElementById('offenseSearch').value = '';
                document.getElementById('searchResults').style.display = 'none';
                aiManager.clearRecommendations();
                utils.showToast('Tool reset successfully!');
            },

            clearOffense() {
                state.selectedOffense = null;
                document.getElementById('selectedOffense').classList.add('hidden');
                document.getElementById('offenseSearch').value = '';
                aiManager.clearRecommendations();
            }
        };

        // AI manager
        const aiManager = {
            async updateRecommendations(offense) {
                const container = document.getElementById('ai-recommendations');
                container.innerHTML = '<div class="text-slate-600"><i class="fas fa-spinner fa-spin mr-2"></i>Analyzing offense...</div>';

                try {
                    const recommendations = await apiClient.getSentencingRecommendations(offense);
                    this.displayRecommendations(recommendations, offense);
                } catch (error) {
                    this.displayDefaultRecommendations(offense);
                }
            },

            displayRecommendations(recommendations, offense) {
                const container = document.getElementById('ai-recommendations');
                
                if (recommendations && recommendations.length > 0) {
                    container.innerHTML = recommendations.map(rec => `
                        <div class="bg-white p-4 rounded-lg border-l-4 border-blue-500">
                            <h4 class="font-semibold text-slate-700 mb-2">${rec.title}</h4>
                            <p class="text-slate-600 text-sm">${rec.description}</p>
                        </div>
                    `).join('');
                } else {
                    this.displayDefaultRecommendations(offense);
                }
            },

            displayDefaultRecommendations(offense) {
                const container = document.getElementById('ai-recommendations');
                const recommendations = [
                    {
                        title: "Constitutional Rights Review",
                        description: "Ensure all constitutional rights are properly explained and waived."
                    },
                    {
                        title: "Voluntariness Assessment",
                        description: "Verify the plea is voluntary and not coerced."
                    },
                    {
                        title: "Understanding Confirmation",
                        description: "Confirm the defendant understands the charges and consequences."
                    }
                ];

                container.innerHTML = recommendations.map(rec => `
                    <div class="bg-white p-4 rounded-lg border-l-4 border-blue-500">
                        <h4 class="font-semibold text-slate-700 mb-2">${rec.title}</h4>
                        <p class="text-slate-600 text-sm">${rec.description}</p>
                    </div>
                `).join('');
            },

            clearRecommendations() {
                const container = document.getElementById('ai-recommendations');
                container.innerHTML = `
                    <div class="text-slate-600">
                        <i class="fas fa-info-circle mr-2"></i>
                        Select an offense to receive AI-powered recommendations.
                    </div>
                `;
            }
        };

        // Initialize application
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize all managers
            searchManager.init();
            colloquyManager.init();
            
            // Update date/time
            utils.updateDateTime();
            setInterval(utils.updateDateTime, 1000);
            
            // Initialize AI recommendations
            aiManager.clearRecommendations();
        });
    </script>
</body>
</html> 